<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ƒê∆°n Gi·∫£n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-box {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
        }
        .product {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .product img {
            max-width: 200px;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test ƒê∆°n Gi·∫£n - GOOJODOQ</h1>

    <div class="test-box">
        <h3>B∆∞·ªõc 1: Ki·ªÉm tra Backend</h3>
        <button onclick="testBackend()">Test Backend</button>
        <div id="backendResult"></div>
    </div>

    <div class="test-box">
        <h3>B∆∞·ªõc 2: L·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m</h3>
        <button onclick="getProducts()">L·∫•y S·∫£n Ph·∫©m</button>
        <div id="productsResult"></div>
        <pre id="productsData"></pre>
    </div>

    <div class="test-box">
        <h3>B∆∞·ªõc 3: Hi·ªÉn th·ªã s·∫£n ph·∫©m</h3>
        <div id="productsList"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        async function testBackend() {
            const result = document.getElementById('backendResult');
            result.innerHTML = '<p>ƒêang ki·ªÉm tra...</p>';
            
            try {
                const response = await fetch(`${API_URL}/test-db`);
                const data = await response.json();
                
                if (response.ok) {
                    result.innerHTML = '<p class="success">‚úÖ Backend ƒëang ch·∫°y t·ªët!</p>';
                    result.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    result.innerHTML = '<p class="error">‚ùå Backend l·ªói: ' + response.status + '</p>';
                }
            } catch (error) {
                result.innerHTML = '<p class="error">‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Backend!</p>';
                result.innerHTML += '<p>L·ªói: ' + error.message + '</p>';
                result.innerHTML += '<p><strong>Gi·∫£i ph√°p:</strong></p>';
                result.innerHTML += '<ol>';
                result.innerHTML += '<li>M·ªü terminal</li>';
                result.innerHTML += '<li>cd Goojodoq_Backend</li>';
                result.innerHTML += '<li>node server.js</li>';
                result.innerHTML += '</ol>';
            }
        }

        async function getProducts() {
            const result = document.getElementById('productsResult');
            const data = document.getElementById('productsData');
            const list = document.getElementById('productsList');
            
            result.innerHTML = '<p>ƒêang l·∫•y d·ªØ li·ªáu...</p>';
            
            try {
                const response = await fetch(`${API_URL}/api/products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const products = await response.json();
                
                if (products && products.length > 0) {
                    result.innerHTML = `<p class="success">‚úÖ L·∫•y ƒë∆∞·ª£c ${products.length} s·∫£n ph·∫©m!</p>`;
                    data.textContent = JSON.stringify(products, null, 2);
                    
                    // Display products
                    list.innerHTML = '<h4>Danh s√°ch s·∫£n ph·∫©m:</h4>';
                    products.forEach(product => {
                        const div = document.createElement('div');
                        div.className = 'product';
                        div.innerHTML = `
                            <h5>${product.product_name}</h5>
                            <p>Gi√°: ${formatPrice(product.price)}</p>
                            ${product.sale_price ? `<p>Gi√° KM: ${formatPrice(product.sale_price)}</p>` : ''}
                            <p>·∫¢nh: ${product.image || 'Kh√¥ng c√≥'}</p>
                            ${product.image ? `<img src="${API_URL}/${product.image}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <p style="display:none; color:red;">‚ùå ·∫¢nh kh√¥ng t·∫£i ƒë∆∞·ª£c</p>` : ''}
                        `;
                        list.appendChild(div);
                    });
                } else {
                    result.innerHTML = '<p class="error">‚ö†Ô∏è Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o!</p>';
                    result.innerHTML += '<p><strong>Gi·∫£i ph√°p:</strong></p>';
                    result.innerHTML += '<ol>';
                    result.innerHTML += '<li>M·ªü MySQL Workbench</li>';
                    result.innerHTML += '<li>Ch·∫°y query: SELECT * FROM products;</li>';
                    result.innerHTML += '<li>N·∫øu tr·ªëng, import file: database/insert_products_with_images.sql</li>';
                    result.innerHTML += '</ol>';
                }
            } catch (error) {
                result.innerHTML = '<p class="error">‚ùå L·ªói khi l·∫•y s·∫£n ph·∫©m!</p>';
                result.innerHTML += '<p>L·ªói: ' + error.message + '</p>';
                
                // Show detailed error
                if (error.message.includes('500')) {
                    result.innerHTML += '<p><strong>L·ªói 500 - Server Error</strong></p>';
                    result.innerHTML += '<p>C√≥ th·ªÉ do:</p>';
                    result.innerHTML += '<ul>';
                    result.innerHTML += '<li>Database ch∆∞a k·∫øt n·ªëi</li>';
                    result.innerHTML += '<li>B·∫£ng products ho·∫∑c product_images ch∆∞a t·∫°o</li>';
                    result.innerHTML += '<li>Query SQL c√≥ l·ªói</li>';
                    result.innerHTML += '</ul>';
                    result.innerHTML += '<p><strong>Gi·∫£i ph√°p:</strong></p>';
                    result.innerHTML += '<ol>';
                    result.innerHTML += '<li>Ki·ªÉm tra MySQL ƒëang ch·∫°y</li>';
                    result.innerHTML += '<li>Ki·ªÉm tra file .env c√≥ ƒë√∫ng th√¥ng tin DB</li>';
                    result.innerHTML += '<li>Xem log trong terminal backend</li>';
                    result.innerHTML += '</ol>';
                }
            }
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price);
        }

        // Auto test on load
        window.addEventListener('load', () => {
            console.log('üß™ Test page loaded');
            console.log('üìç API URL:', API_URL);
        });
    </script>
</body>
</html>