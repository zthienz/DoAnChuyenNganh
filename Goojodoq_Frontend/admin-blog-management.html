<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω b√†i vi·∫øt - Admin GOOJODOQ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <style>
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
        }
        
        .blog-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .blog-thumbnail {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .status-badge {
            font-size: 0.8em;
        }
        
        .action-buttons .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
    </style>
</head>

<body>
    <!-- Admin Header -->
    <section class="admin-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="mb-2">Qu·∫£n l√Ω b√†i vi·∫øt</h1>
                    <p class="mb-0">Qu·∫£n l√Ω t·∫•t c·∫£ b√†i vi·∫øt tr√™n website GOOJODOQ</p>
                </div>
                <div>
                    <a href="admin-add-blog.html" class="btn btn-light me-2">
                        <i class="fas fa-plus me-2"></i>Th√™m b√†i vi·∫øt
                    </a>
                    <a href="blog.html" class="btn btn-outline-light">
                        <i class="fas fa-eye me-2"></i>Xem trang b√†i vi·∫øt
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="py-5 bg-light">
        <div class="container">
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-primary" id="totalPosts">0</h3>
                            <p class="mb-0">T·ªïng b√†i vi·∫øt</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-success" id="publishedPosts">0</h3>
                            <p class="mb-0">ƒê√£ xu·∫•t b·∫£n</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-warning" id="draftPosts">0</h3>
                            <p class="mb-0">B·∫£n nh√°p</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h3 class="text-info" id="thisMonth">0</h3>
                            <p class="mb-0">Th√°ng n√†y</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="searchInput" placeholder="T√¨m ki·∫øm b√†i vi·∫øt...">
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="categoryFilter">
                                <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                                <option value="ƒê√°nh gi√° s·∫£n ph·∫©m">ƒê√°nh gi√° s·∫£n ph·∫©m</option>
                                <option value="H∆∞·ªõng d·∫´n">H∆∞·ªõng d·∫´n</option>
                                <option value="Tin t·ª©c">Tin t·ª©c</option>
                                <option value="Khuy·∫øn m√£i">Khuy·∫øn m√£i</option>
                                <option value="C√¥ng ngh·ªá">C√¥ng ngh·ªá</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="sortBy">
                                <option value="date">S·∫Øp x·∫øp theo ng√†y</option>
                                <option value="title">S·∫Øp x·∫øp theo ti√™u ƒë·ªÅ</option>
                                <option value="category">S·∫Øp x·∫øp theo danh m·ª•c</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <div class="d-flex gap-1">
                                <button class="btn btn-outline-secondary" onclick="clearFilters()" title="X√≥a b·ªô l·ªçc">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button class="btn btn-outline-primary" onclick="loadBlogPosts()" title="L√†m m·ªõi">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Blog Posts Table -->
            <div class="blog-table">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>H√¨nh ·∫£nh</th>
                                <th>Ti√™u ƒë·ªÅ</th>
                                <th>Danh m·ª•c</th>
                                <th>T√°c gi·∫£</th>
                                <th>Ng√†y t·∫°o</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="blogTableBody">
                            <!-- Blog posts will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <nav class="mt-4">
                <ul class="pagination justify-content-center" id="pagination">
                    <!-- Pagination will be generated here -->
                </ul>
            </nav>
        </div>
    </section>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">X√°c nh·∫≠n x√≥a</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i vi·∫øt n√†y kh√¥ng?</p>
                    <p class="text-danger"><strong>L∆∞u √Ω:</strong> H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">X√≥a</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        let blogPosts = [];
        let filteredPosts = [];
        let currentPage = 1;
        const postsPerPage = 10;
        let postToDelete = null;

        // Load blog posts
        function loadBlogPosts() {
            blogPosts = JSON.parse(localStorage.getItem('blogPosts')) || [];
            
            // If no blog posts exist, initialize with sample data
            if (blogPosts.length === 0) {
                console.log('üîÑ No blog posts found, initializing with sample data...');
                initializeSampleData();
            }
            
            filteredPosts = [...blogPosts];
            updateStats();
            displayPosts();
            generatePagination();
        }

        // Initialize sample data
        function initializeSampleData() {
            const samplePosts = [
                {
                    id: 1,
                    title: "Top 5 tai nghe Bluetooth t·ªët nh·∫•t nƒÉm 2025",
                    excerpt: "Kh√°m ph√° nh·ªØng m·∫´u tai nghe Bluetooth ch·∫•t l∆∞·ª£ng cao v·ªõi √¢m thanh tuy·ªát v·ªùi v√† pin b·ªÅn b·ªâ...",
                    content: `
                        <h2>Gi·ªõi thi·ªáu</h2>
                        <p>Tai nghe Bluetooth ƒë√£ tr·ªü th√†nh ph·ª• ki·ªán kh√¥ng th·ªÉ thi·∫øu trong cu·ªôc s·ªëng hi·ªán ƒë·∫°i. V·ªõi s·ª± ph√°t tri·ªÉn c·ªßa c√¥ng ngh·ªá, c√°c s·∫£n ph·∫©m tai nghe Bluetooth ng√†y c√†ng ƒë∆∞·ª£c c·∫£i ti·∫øn v·ªÅ ch·∫•t l∆∞·ª£ng √¢m thanh, th·ªùi l∆∞·ª£ng pin v√† t√≠nh nƒÉng th√¥ng minh.</p>
                        
                        <h3>1. GOOJODOQ Air Pro</h3>
                        <p>V·ªõi c√¥ng ngh·ªá ch·ªëng ·ªìn ch·ªß ƒë·ªông ANC v√† th·ªùi l∆∞·ª£ng pin l√™n ƒë·∫øn 30 gi·ªù, GOOJODOQ Air Pro l√† l·ª±a ch·ªçn h√†ng ƒë·∫ßu cho nh·ªØng ai y√™u th√≠ch √¢m nh·∫°c ch·∫•t l∆∞·ª£ng cao.</p>
                        
                        <h3>2. GOOJODOQ Sport</h3>
                        <p>Thi·∫øt k·∫ø ch·ªëng n∆∞·ªõc IPX7, ph√π h·ª£p cho c√°c ho·∫°t ƒë·ªông th·ªÉ thao v√† t·∫≠p luy·ªán. √Çm thanh m·∫°nh m·∫Ω v·ªõi bass s√¢u.</p>
                        
                        <h3>K·∫øt lu·∫≠n</h3>
                        <p>Vi·ªác ch·ªçn tai nghe Bluetooth ph√π h·ª£p ph·ª• thu·ªôc v√†o nhu c·∫ßu s·ª≠ d·ª•ng c·ªßa t·ª´ng ng∆∞·ªùi. H√£y c√¢n nh·∫Øc c√°c y·∫øu t·ªë nh∆∞ ch·∫•t l∆∞·ª£ng √¢m thanh, th·ªùi l∆∞·ª£ng pin v√† gi√° c·∫£ ƒë·ªÉ ƒë∆∞a ra quy·∫øt ƒë·ªãnh t·ªët nh·∫•t.</p>
                    `,
                    category: "ƒê√°nh gi√° s·∫£n ph·∫©m",
                    date: "20/11/2025",
                    image: "images/products/TAINGHE001-1.webp",
                    author: "Admin"
                },
                {
                    id: 2,
                    title: "H∆∞·ªõng d·∫´n ch·ªçn qu·∫°t mini ph√π h·ª£p cho m√πa h√®",
                    excerpt: "M√πa h√® ƒëang ƒë·∫øn, c√πng t√¨m hi·ªÉu c√°ch ch·ªçn qu·∫°t mini ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n...",
                    content: `
                        <h2>T·∫°i sao n√™n ch·ªçn qu·∫°t mini?</h2>
                        <p>Qu·∫°t mini l√† gi·∫£i ph√°p tuy·ªát v·ªùi cho nh·ªØng ng√†y h√® n√≥ng b·ª©c. V·ªõi k√≠ch th∆∞·ªõc nh·ªè g·ªçn, d·ªÖ d√†ng mang theo v√† s·ª≠ d·ª•ng ·ªü m·ªçi n∆°i.</p>
                        
                        <h3>C√°c ti√™u ch√≠ ch·ªçn qu·∫°t mini</h3>
                        <ul>
                            <li><strong>Th·ªùi l∆∞·ª£ng pin:</strong> N√™n ch·ªçn s·∫£n ph·∫©m c√≥ pin t·ª´ 4-8 gi·ªù</li>
                            <li><strong>T·ªëc ƒë·ªô gi√≥:</strong> C√≥ √≠t nh·∫•t 3 c·∫•p ƒë·ªô ƒëi·ªÅu ch·ªânh</li>
                            <li><strong>ƒê·ªô ·ªìn:</strong> D∆∞·ªõi 40dB ƒë·ªÉ kh√¥ng g√¢y kh√≥ ch·ªãu</li>
                            <li><strong>Ch·∫•t li·ªáu:</strong> Nh·ª±a ABS cao c·∫•p, an to√†n</li>
                        </ul>
                        
                        <h3>S·∫£n ph·∫©m ƒë·ªÅ xu·∫•t</h3>
                        <p>GOOJODOQ Mini Fan v·ªõi thi·∫øt k·∫ø hi·ªán ƒë·∫°i, pin 6 gi·ªù v√† 3 c·∫•p ƒë·ªô gi√≥ l√† l·ª±a ch·ªçn tuy·ªát v·ªùi cho m√πa h√® n√†y.</p>
                    `,
                    category: "H∆∞·ªõng d·∫´n",
                    date: "18/11/2025",
                    image: "images/products/QUAT001-1.webp",
                    author: "Admin"
                },
                {
                    id: 3,
                    title: "GOOJODOQ ra m·∫Øt b·ªô s∆∞u t·∫≠p ph·ª• ki·ªán m·ªõi",
                    excerpt: "Ch√∫ng t√¥i vui m·ª´ng gi·ªõi thi·ªáu b·ªô s∆∞u t·∫≠p ph·ª• ki·ªán ƒëi·ªán t·ª≠ m·ªõi nh·∫•t v·ªõi nhi·ªÅu t√≠nh nƒÉng ∆∞u vi·ªát...",
                    content: `
                        <h2>B·ªô s∆∞u t·∫≠p m·ªõi 2025</h2>
                        <p>GOOJODOQ t·ª± h√†o gi·ªõi thi·ªáu b·ªô s∆∞u t·∫≠p ph·ª• ki·ªán ƒëi·ªán t·ª≠ m·ªõi nh·∫•t v·ªõi thi·∫øt k·∫ø hi·ªán ƒë·∫°i v√† c√¥ng ngh·ªá ti√™n ti·∫øn.</p>
                        
                        <h3>S·∫£n ph·∫©m n·ªïi b·∫≠t</h3>
                        <ol>
                            <li>Hub USB-C 7 trong 1</li>
                            <li>S·∫°c d·ª± ph√≤ng 20000mAh</li>
                            <li>C√°p s·∫°c nhanh 100W</li>
                            <li>ƒê·∫ø s·∫°c kh√¥ng d√¢y 15W</li>
                        </ol>
                        
                        <p>T·∫•t c·∫£ s·∫£n ph·∫©m ƒë·ªÅu ƒë∆∞·ª£c thi·∫øt k·∫ø v·ªõi ch·∫•t l∆∞·ª£ng cao v√† gi√° c·∫£ h·ª£p l√Ω, ph√π h·ª£p v·ªõi m·ªçi ƒë·ªëi t∆∞·ª£ng kh√°ch h√†ng.</p>
                    `,
                    category: "Tin t·ª©c",
                    date: "15/11/2025",
                    image: "images/products/HUB001_1.webp",
                    author: "Admin"
                }
            ];
            
            blogPosts = samplePosts;
            localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
            console.log('‚úÖ Sample blog posts initialized');
        }

        // Update statistics
        function updateStats() {
            const total = blogPosts.length;
            const published = blogPosts.filter(post => !post.status || post.status !== 'draft').length;
            const drafts = blogPosts.filter(post => post.status === 'draft').length;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const thisMonth = blogPosts.filter(post => {
                try {
                    const postDate = new Date(post.date.split('/').reverse().join('-'));
                    return postDate.getMonth() === currentMonth && postDate.getFullYear() === currentYear;
                } catch (e) {
                    return false;
                }
            }).length;

            document.getElementById('totalPosts').textContent = total;
            document.getElementById('publishedPosts').textContent = published;
            document.getElementById('draftPosts').textContent = drafts;
            document.getElementById('thisMonth').textContent = thisMonth;
        }

        // Display posts in table
        function displayPosts() {
            const startIndex = (currentPage - 1) * postsPerPage;
            const endIndex = startIndex + postsPerPage;
            const postsToShow = filteredPosts.slice(startIndex, endIndex);

            const tbody = document.getElementById('blogTableBody');
            
            if (postsToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Kh√¥ng c√≥ b√†i vi·∫øt n√†o</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = postsToShow.map(post => `
                <tr>
                    <td>
                        <img src="${post.image}" alt="${post.title}" class="blog-thumbnail"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2260%22%3E%3Crect width=%2280%22 height=%2260%22 fill=%22%23e0e0e0%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2210%22 fill=%22%23999%22%3ENo Image%3C/text%3E%3C/svg%3E'">
                    </td>
                    <td>
                        <div>
                            <h6 class="mb-1">${post.title}</h6>
                            <small class="text-muted">${post.excerpt.substring(0, 80)}...</small>
                        </div>
                    </td>
                    <td>
                        <span class="badge bg-primary">${post.category}</span>
                    </td>
                    <td>${post.author}</td>
                    <td>${post.date}</td>
                    <td>
                        <span class="badge status-badge ${post.status === 'draft' ? 'bg-warning' : 'bg-success'}">
                            ${post.status === 'draft' ? 'B·∫£n nh√°p' : 'ƒê√£ xu·∫•t b·∫£n'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="blog-detail.html?id=${post.id}" class="btn btn-sm btn-outline-primary" title="Xem">
                                <i class="fas fa-eye"></i>
                            </a>
                            <button class="btn btn-sm btn-outline-warning" onclick="editPost(${post.id})" title="S·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deletePost(${post.id})" title="X√≥a">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Generate pagination
        function generatePagination() {
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';

            // Previous button
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Tr∆∞·ªõc</a>
                </li>
            `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }

            // Next button
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Sau</a>
                </li>
            `;

            pagination.innerHTML = paginationHTML;
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayPosts();
                generatePagination();
            }
        }

        // Filter posts
        function filterPosts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            filteredPosts = blogPosts.filter(post => {
                const matchesSearch = post.title.toLowerCase().includes(searchTerm) || 
                                    post.excerpt.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || post.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });

            // Sort posts
            filteredPosts.sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    case 'date':
                    default:
                        return new Date(b.date.split('/').reverse().join('-')) - new Date(a.date.split('/').reverse().join('-'));
                }
            });

            currentPage = 1;
            displayPosts();
            generatePagination();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('sortBy').value = 'date';
            filterPosts();
        }

        // Edit post
        function editPost(id) {
            // For now, redirect to add page with edit mode
            // In a real application, you would pass the post ID and load it for editing
            window.location.href = `admin-add-blog.html?edit=${id}`;
        }

        // Delete post
        function deletePost(id) {
            postToDelete = id;
            const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
            modal.show();
        }

        // Confirm delete
        document.getElementById('confirmDelete').addEventListener('click', function() {
            if (postToDelete) {
                blogPosts = blogPosts.filter(post => post.id !== postToDelete);
                localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                modal.hide();
                
                loadBlogPosts();
                postToDelete = null;
            }
        });

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', filterPosts);
        document.getElementById('categoryFilter').addEventListener('change', filterPosts);
        document.getElementById('sortBy').addEventListener('change', filterPosts);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check admin access
            const currentUser = JSON.parse(localStorage.getItem('user') || sessionStorage.getItem('user') || 'null');
            if (!currentUser || currentUser.quyen !== 'admin') {
                alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p v·ªõi quy·ªÅn admin ƒë·ªÉ truy c·∫≠p trang n√†y!');
                window.location.href = 'admin-login.html';
                return;
            }

            console.log('üîç Admin Blog Management - Loading posts...');
            loadBlogPosts();
            
            // Debug: Log current localStorage data
            const storedPosts = localStorage.getItem('blogPosts');
            console.log('üìä Current localStorage blogPosts:', storedPosts ? JSON.parse(storedPosts) : 'No data');
        });
    </script>
</body>

</html>